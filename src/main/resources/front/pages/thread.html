 <!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>suse校园社区</title>

    <!-- Bootstrap -->
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!--axios开发环境-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>

    <!-- Bootstrap -->
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/content-area.css" rel="stylesheet">
    <link href="../css/forum.css" rel="stylesheet">
    <link href="../css/sidebar.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/content-area.css" rel="stylesheet">
    <link href="../css/sidebar.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">
    <!--    <link href="../node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet">-->

    <!--    <link href="../node_modules/font-awesome/css/font-awesome.css" rel="stylesheet">-->
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/content-area.css" rel="stylesheet">
    <link href="../css/thread.css" rel="stylesheet">
    <link href="../css/sidebar.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>

    <![endif]-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="../../static/12-1/node_modules/jquery/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../../static/12-1/node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <!-- js -->
    <script src="../../static/12-1/js/common.js"></script>
    <link href="../../static/12-1/css/slider.css" rel="stylesheet">
    <script src="../../static/12-1/js/slider.js"></script>
    <style>
        .keyin {
            width: 300px;
            height: 120px;
            background: url(images/logo.gif) no-repeat right top;
            border: 1px solid #999666;
            resize: none;
            border-radius: 10px;
            display: none;
        }

        .con_hide {
            border-radius: 10px;
        }

        #host_area {
            width: 300px;
            height: 120px;
            background: url(images/logo.gif) no-repeat right top;
            border: 1px solid #999666;
            resize: none;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>
<div id="app">
<div class="header" >
    <div class="second-nav bg-white">
        <div class="container">
            <div class="logo pull-left">
                <a href="../../static/index.html"> <img src="../picture/qiku_community_logo.png" alt=""></a>
            </div>
            <ul class="menu pull-left">
                <li class="active"><a href="../pages/index.html">首页</a></li>
                <li><a href="../pages/forum.html">论坛</a></li>
                <li><a href="group.html">校园</a></li>

            </ul>


            <div class="login-reg pull-right">
                <a href="login.html" target="_blank" v-show="user.userStatus==null">登录</a>
                <a href="register.html" target="_blank" v-if="user.userStatus === null">注册</a>
                <a href="" v-else>{{ user.userAccountId }}</a>
                <a href="personal.html" target="_blank">个人</a>
            </div>
            <div class="search-form pull-right">
                <div class="input-group">
                    <input type="text" class="form-control" name="name" value="" placeholder="帖子/用户">
                    <div class="input-group-btn">
                        <button type="button" class="btn btn-default">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--  -->
<div class="container main" >

    <!-- 左侧内容区 -->
    <div class="content-area bg-white">
        <div class="mn xm_mn">

            <div id="pt-detail" class="bm cl">
                <div class="viewthread-bread">
                    <a href="#">版块</a>
                    <em>›</em> <a href="#">同城</a> <em>›</em><a href="#">板块名</a></div>
            </div>


            <div class="xm_tp">
                <div class="xm_p_tp">

                    <!--id="tath"-->
                    <a href="http://#.cn/space-uid-30006763.html" title="天谴执行官" class="xm_avt">

                    </a>

                    <h1>
                        {{ host.topicTitle }}
                    </h1>

                    <div class="xm_tp_action">

                        <span>{{ host.createTime }}}</span>


                        <div class="y">
                            <div class="xm_tp_action">
                                <span class="y replies-uncursor">{{ host.topicClickCount }}</span>
                                <span class="y viewnum-uncursor">{{
                                        host.topicClickCount + host.topicReplyCount
                                    }}</span>
                            </div>
                        </div>

                    </div>


                </div>

            </div>


            <div id="postlist" class="pl">


                <div id="post_102757647">


                    <table id="pid102757647" class="plhin post_lz" summary="pid102757647" cellspacing="0"
                           cellpadding="0">
                        <tbody>
                        <tr>
                            <td class="plc">
                                <div class="pct">
                                    <div class="pcb">

                                        <div class="pcbs">
                                            <div class="act pbm cl">
                                                <img src="" alt="" title="镇楼图">
                                                {{ host.topicContent }}
                                            </div>
                                        </div>

                                        <div class="article-functions">
                                            <div class="viewthread-fivefunctions">
                                                <!--不能点-->
                                            </div>
                                            <div>
                                                <a id="comment">回复楼主</a>
                                                <textarea name="inner_reply" id="host_area" cols="30"
                                                          rows="5" v-model="hostContent">点此输入</textarea>
                                                <span style="color: #00aaaa;display: none;cursor: grab" id="host_btn">
                                                        <a @click="click_reply(1)">回复</a>
                                                </span>
                                            </div>

                                        </div>

                                    </div>
                                    <div id="comment_102757647" class="">
                                    </div>

                                    <div id="post_rate_div_102757647"></div>
                                </div>
                        <tr id="_postposition102757647"></tr>
                        <tr>
                            <td class="plc" style="overflow:visible;">
                                <div class="po hin">
                                </div>
                            </td>
                        </tr>
                        <tr class="ad">
                            <td class="plc">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="comments-static">
                        <p class="comments-p">评论</p>
                        <p class="comments-floor">
                            <span id="fj">
              </span>
                        </p>
                    </div>
                </div>
                <div id="post_102771656"   v-for="(item, index) in host.replys" >
                    <table id="pid102771656" class="plhin" summary="pid102771656" cellspacing="0" cellpadding="0">
                        <tbody>
                        <tr>
                            <td class="pls" rowspan="2">
                                <div id="favatar102771656" class="pls favatar">
                                    <div class="avatar">
                                        <!--用户头像-->
                                        <img src="../picture/5768b8f0967e91f1.jpg" alt="">
                                    </div>
                                </div>
                            </td>

                            <td class="plc">
                                <div class="pi floornum">
                                    <strong class="y">
                                        <a>第{{ index + 1 }}楼</a>
                                    </strong>
                                    <div class="pti">
                                        <div class="pdbt">
                                        </div>

                                        <div class="authi">
                                      <span class="author">
                                          <a  >{{
                                                  user.userAccountId
                                              }}</a>
                                      </span>
                                            <em id="authorposton102771656">{{ item.createTime }}</em>
                                            <span class="pipe">|</span>

                                            <span class="pipe">|</span>
                                            <a>举报</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="pct">
                                    <div class="pcb">
                                        <div class="pcbs">
                                            <table cellspacing="0" cellpadding="0">
                                                <tbody>
                                                <tr>
                                                    <td class="t_f postmessage-top" id="postmessage_102771656">
                                                        {{ item.replyContents }}
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="comment_102771656" class="">
                                        </div>

                                        <div id="post_rate_div_102771656"></div>
                                    </div>
                                </div>


                                <div style="background-color: #dddddd;width: 400px;"  class="con_hide" >
                                    <!--&lt;!&ndash;&lt;!&ndash;v-for="(rep,idx) in item.m_replys&ndash;&gt;-->
                                    <!--<span>{{rep.userId}}}回复{{item.userId}}}：{{rep.replyContents}}} &emsp;</span>-->
                                    <span >{{item.userId}}回复{{host.userId}}：</span>
                                    <textarea name="inner_reply"  cols="30" rows="5"
                                              class="keyin" v-model="otherContent">点此输入</textarea>

                                    <span style="color: #00aaaa;display: none;cursor: grab" class="overhide">
                                        <a @click="click_reply(2, item, index)">回复</a>
                                    </span>
                                    <hr>
                                    <div style="background-color: #dddddd;width: 400px;" class="con_hide" v-for="(rep,idx) in item.m_replys"  >
                                        <!--v-for="(rep,idx) in item.m_replys"-->
                                        <!--<span>{{rep.userId}}}回复{{item.userId}}}：{{rep.replyContents}}} &emsp;</span>-->
                                        <span >{{rep.userId}}回复{{item.userId}}：{{rep.replyContents}}</span>
                                        <textarea name="inner_reply"  cols="30" rows="5"
                                                  class="keyin" v-model="otherContent">点此输入</textarea>
                                        <!--span>{{rep.userId}}}回复{{item.userId}}}：{{rep.replyContents}}}</span>-->
                                        <span style="color: #00aaaa;display: none;cursor: grab" class="overhide">
                                        <a @click="click_reply(2, rep, index)">回复</a>
                                             </span>
                                        <hr>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr id="_postposition102771656"></tr>
                        <tr style="height:36px;">
                            <td>
                            </td>
                            <td class="plc" style="overflow:visible;">
                            </td>
                        </tr>
            <tr class="ad">
                <td class="pls">
                </td>
                <td class="plc">
                </td>
            </tr>
            </tbody>
            </table>
        </div>
        <div id="postlistreply" class="pl">
            <div id="post_new" class="viewthread_table" style="display: none"></div>
        </div>
    </div>


    <form method="post" autocomplete="off" name="modactions" id="modactions">
        <input type="hidden" name="formhash" value="c4d1a738">
        <input type="hidden" name="optgroup">
        <input type="hidden" name="operation">
        <input type="hidden" name="listextra" value="">
        <input type="hidden" name="page" value="1">
    </form>


    <div class="pgs cl">
        <span class="pgb" onclick="window.history.back()">返回列表</span></div>


    <!--[diy=diyfastposttop]-->
    <div id="diyfastposttop" class="area"></div><!--[/diy]-->


</div>
</div>
</div>

<!-- footer --><!-- other -->
<button type="button" id="backTop" class="btn btn-default">
    <i class="fa fa-arrow-up"></i>
</button>
</div>

</body>
<!--<script type="text/javascript">document.onkeyup = function (e) {
    keyPageScroll(e, 0, 0, 'forum.php?mod=viewthread&tid=14646386', 1);
}</script>-->
<script src="../js/package.js"></script>
<script>
    new Vue({
        el: "#app",

        data: {
            urlBase:'http://172.23.161.242:8080/',
            host:
                {
                    createTime: "2022-11-01 16:16:27",
                    replys: [{
                        createTime: null,
                        replyClickCount: 0,
                        replyContents: "dfgfdsgfsdbgdfsgdf",
                        replyEmotion: null,
                        replyFloor:null,
                        replyId: "3133",
                        topicId: "1",
                        updateTime: null,
                        userId: "1586600449878847489",
                        m_replys: [
                            {replyContents: "hello"},
                            {replyContents: "world"}
                        ]
                    }],
                    sectionId: "1",
                    topicClickCount: 1,
                    topicContent: "fuck you",
                    topicEmotion: null,
                    topicId: "1",
                    topicReplyCount: 1,
                    topicTitle: "纯路人",
                    updateTime: "2022-11-01 16:16:27",
                    userId: "1586600449878847489",
                },
            reply:
                {
                    createTime: null,
                    replyClickCount: null,
                    replyContents: null,
                    replyEmotion: null,
                    replyId: null,
                    replyFloor:null,
                    topicId: null,
                    updateTime: null,
                    userId: null,
                    m_replys: [
                        {replyContents: "hello"}
                    ]
                },

            user: {
                id: null,
                userAccountId: "hjkgbhjbj",
                username: 666,
                password: null,
                userEmail: null,
                userSex: null,
                userClass: null,
                userStatement: null,
                userStatus: null
            },
            hostContent:null,
            otherContent:null,
        },
        beforeMount() {
            /**
             * id为纯数字，可以采用url的方式放入topicID
             */
            let _this = this
            console.log(_this.urlBase)
            axios({
                method: 'get',
                url: _this.urlBase+"user/get",
            }).then(res => {
                console.log(res);
                _this.user = res.data.data
                console.log("获取到用户信息{}", _this.user)
            }, err => {
                console.log(err);
            });
            this.get_data()
            //1.解析topicID
        },
        mounted(){
            this.$nextTick(function (){


            })

        },
        methods: {
            visiable(){
                let inner_spans = document.querySelectorAll(".con_hide")
                let keyins = document.querySelectorAll(".keyin");
                let spans = document.querySelectorAll(".overhide");

                for (let i = 0; i < spans.length; i++) {
                    inner_spans[i].addEventListener("click", function (evt) {
                        for (let j = 0; j < spans.length; j++) {
                            spans[j].style.display = "none";
                            keyins[j].style.display = "none";
                        }
                        spans[i].style.display = "block";
                        keyins[i].style.display = "block";

                    },false)

                }
            },
            async get_data() {
                let id = window.location.href.split("?")[1];
                let res = await getTopicById(this.urlBase+"topic/detail?id=" + id)
                console.log("res = ", res)
                this.host = res.data.data
                //this.reply = this.host.replys
                console.log("replys = ", this.reply)


            },
            /*reply_user(id) {
                console.log('id =', id)
                let status = id === undefined ? 1 : 2
                window.open('fatie.html?' + status + '&' + this.host.topicId + (id === undefined ? '' : '&' + id))
            },*/
            async click_reply(status) {
                console.log("this.reply = ",this.reply)
                let reply = this.reply;
                console.log(reply)
                //赋值status
                //reply.status = status;
                if (status === 2) {
                    let index = arguments[2];
                    let item = arguments[1];
                    //传入index获取对应textarea值
                    reply.replyContents = this.otherContent;
                    console.log(this.otherContent)
                    //赋值tipicID
                    reply.topicId = item.topicId;
                    //赋值楼层
                    reply.replyFloor = item.replyId;
                } else {
                    //赋值content
                    reply.replyContents = this.hostContent;
                    console.log("area = ",this.hostContent)
                    //赋值topicID
                    reply.topicId = this.host.topicId;
                }
                //发送请求
                let res = await post_comm(this.urlBase+"reply/answer", reply);
                if (res.data.code === 1) {
                    this.$message.success("回复成功！")
                    window.location.reload(true);
                } else this.$message.error("回复失败!")
            }
        }
    })
    let loop = 0;
    let area = document.querySelector("#host_area");
    let btn = document.querySelector("#host_btn");
    document.querySelector("#comment").addEventListener("click", function () {
        if (loop % 2 === 0) {
            area.style.display = "block";
            btn.style.display = "block";
        } else {
            area.style.display = "none";
            btn.style.display = "none";
        }
        loop++;
    })
    //------------------------------------------------------------------
    window.addEventListener("DOMContentLoaded",function(){
        setTimeout(function (){}, 500)
        let inner_spans = document.querySelectorAll(".con_hide")
        let keyins = document.querySelectorAll(".keyin");
        let spans = document.querySelectorAll(".overhide");

        console.log(spans.length)
        for (let i = 0; i < spans.length; i++) {
            inner_spans[i].addEventListener("click", function (evt) {
                for (let j = 0; j < spans.length; j++) {
                    spans[j].style.display = "none";
                    keyins[j].style.display = "none";
                }
                spans[i].style.display = "block";
                keyins[i].style.display = "block";
            },true)
        }

    })
</script>
</html>
